"use strict";(self.webpackChunkAdmin=self.webpackChunkAdmin||[]).push([[5798],{5798:function(e,l,i){i.r(l),i.d(l,{default:function(){return V}});var a=i(3396),s=i(4870),t=i(7139),o=i(9242),u=i(2807),n=i(9584),c={apiObj:n.y7,menuApiObj:n.VO,listApiObj:n.af,successCode:200,maxSize:30,max:99,uploadParseData:e=>({id:e.data.id,fileName:e.data.fileName,url:e.data.src}),listParseData:e=>({rows:e.data.rows,total:e.data.total,msg:e.message,code:e.code}),request:{page:"page",pageSize:"pageSize",keyword:"keyword",menuKey:"groupId"},menuProps:{key:"id",label:"label",children:"children"},fileProps:{key:"id",fileName:"fileName",url:"url"},files:{doc:{icon:"sc-icon-file-word-2-fill",color:"#409eff"},docx:{icon:"sc-icon-file-word-2-fill",color:"#409eff"},xls:{icon:"sc-icon-file-excel-2-fill",color:"#67C23A"},xlsx:{icon:"sc-icon-file-excel-2-fill",color:"#67C23A"},ppt:{icon:"sc-icon-file-ppt-2-fill",color:"#F56C6C"},pptx:{icon:"sc-icon-file-ppt-2-fill",color:"#F56C6C"}}};const r=e=>((0,a.dD)("data-v-742ef626"),e=e(),(0,a.Cn)(),e),d={class:"sc-file-select"},p={class:"sc-file-select__side"},f={class:"sc-file-select__side-menu"},m={class:"el-tree-node__label"},g={key:0,class:"sc-file-select__side-msg"},_=(0,a.Uk)(" 已选择 "),S=(0,a.Uk)(" / "),v=(0,a.Uk)(" 项 "),U={class:"sc-file-select__files"},y={class:"sc-file-select__top"},k={key:0,class:"upload"},w=(0,a.Uk)("本地上传"),b={class:"tips"},h={class:"keyword"},x={class:"sc-file-select__list"},C={class:"sc-file-select__item__file"},z={class:"sc-file-select__item__upload"},P=["onClick"],D={class:"sc-file-select__item__file"},H={key:0,class:"sc-file-select__item__checkbox"},W={key:1,class:"sc-file-select__item__select"},N=r((()=>(0,a._)("div",{class:"sc-file-select__item__box"},null,-1))),q={key:3,class:"item-file item-file-doc"},I={key:1,class:"sc-icon-file-list-fill",style:{color:"#999"}},O=["title"],j={class:"sc-file-select__pagination"},R={class:"sc-file-select__do"},A=(0,a.Uk)("确 定");var L={props:{modelValue:null,hideUpload:{type:Boolean,default:!1},multiple:{type:Boolean,default:!1},max:{type:Number,default:c.max},onlyImage:{type:Boolean,default:!1},maxSize:{type:Number,default:c.maxSize}},emits:["update:modelValue","submit"],setup(e,{emit:l}){const i=e,{groupRef:n,scrollbarRef:r,keyword:L,listLoading:V,menuLoading:B,pageSize:K,currentPage:E,total:F,data:J,fileList:Y,value:M,menu:$,accept:Q,treeProps:T,fileProps:Z,files:G,groupClick:X,reload:ee,search:le,select:ie,submit:ae,_isImg:se,_getExt:te,uploadChange:oe,uploadBefore:ue,uploadRequest:ne,uploadProcess:ce,uploadSuccess:re,uploadError:de}=function(e,l){const i=(0,s.iH)(null),t=(0,s.iH)(null),o=(0,s.iH)(null),n=(0,s.iH)(!1),r=(0,s.iH)(!1),d=(0,s.iH)(0),p=(0,s.iH)(1),f=(0,s.iH)(20),m=(0,s.iH)(""),g=(0,s.iH)([]),_=(0,s.iH)([]),S=(0,s.iH)([]),v=(0,s.iH)(e.multiple?[]:""),U=(0,s.iH)(e.onlyImage?"image/gif, image/jpeg, image/png":""),y=(0,s.iH)(c.menuProps),k=(0,s.iH)(c.fileProps),w=(0,s.iH)(c.files);async function b(){n.value=!0;let l={[c.request.menuKey]:m.value,[c.request.page]:p.value,[c.request.pageSize]:f.value,[c.request.keyword]:o.value};e.onlyImage&&(l.type="image");const i=await c.listApiObj.get(l),a=c.listParseData(i);g.value=a.rows,d.value=a.total,n.value=!1,t.value.setScrollTop(0)}return(0,a.bv)((()=>{!async function(){r.value=!0;const e=await c.menuApiObj.get();_.value=e.data,r.value=!1}(),b()})),(0,a.YP)((()=>e.multiple),(()=>{v.value=e.multiple?[]:"",l(JSON.parse(JSON.stringify(v.value)))})),{groupRef:i,scrollbarRef:t,keyword:o,listLoading:n,menuLoading:r,pageSize:f,currentPage:p,total:d,menuId:m,data:g,fileList:S,value:v,menu:_,accept:U,treeProps:y,fileProps:k,files:w,groupClick:function(e){m.value=e.id,p.value=1,o.value=null,b()},reload:function(){b()},search:function(){p.value=1,b()},select:function(l){const i=v.value,a=l[k.value.url];e.multiple?i.includes(a)?v.value.splice(i.findIndex((e=>e===a)),1):v.value.push(a):v.value.includes(a)?v.value="":v.value=a},submit:function(){const e=JSON.parse(JSON.stringify(v.value));l("update:modelValue",e),l("submit",e)},_isImg:function(e){const l=e.substring(e.lastIndexOf("."));return-1!==[".jpg",".jpeg",".png",".gif",".bmp"].indexOf(l)},_getExt:function(e){return e.substring(e.lastIndexOf(".")+1)},uploadChange:function(e,l){e.tempImg=URL.createObjectURL(e.raw),S.value=l},uploadBefore:function(l){const i=e.maxSize;if(!(l.size/1024/1024<i))return u.z8.warning(`上传文件大小不能超过 ${i}MB!`),!1},uploadRequest:function(e){const l=c.apiObj,i=new FormData;i.append("file",e.file),i.append([c.request.menuKey],m.value),l.post(i,{onUploadProgress:l=>{e.onProgress(l)}}).then((l=>{e.onSuccess(l)})).catch((l=>{e.onError(l)}))},uploadProcess:function(e,l){l.progress=Number((e.loaded/e.total*100).toFixed(2))},uploadSuccess:function(l,i){S.value.splice(S.value.findIndex((e=>e.uid===i.uid)),1);const a=c.uploadParseData(l),s=k.value;g.value.unshift({[s.key]:a.id,[s.fileName]:a.fileName,[s.url]:a.url}),e.multiple||(v.value=a.url)},uploadError:function(){(0,u.z8)({title:"上传文件错误",type:"error"})}}}(i,(function(e,i){e&&l("update:modelValue",M),i&&l("submit",M)}));return(l,i)=>{const u=(0,a.up)("el-icon-folder"),c=(0,a.up)("el-icon"),pe=(0,a.up)("el-tree"),fe=(0,a.up)("el-button"),me=(0,a.up)("el-upload"),ge=(0,a.up)("el-icon-warning"),_e=(0,a.up)("el-input"),Se=(0,a.up)("el-empty"),ve=(0,a.up)("el-progress"),Ue=(0,a.up)("el-image"),ye=(0,a.up)("el-icon-check"),ke=(0,a.up)("el-scrollbar"),we=(0,a.up)("el-pagination"),be=(0,a.Q2)("loading");return(0,a.wg)(),(0,a.iD)("div",d,[(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",p,[(0,a._)("div",f,[(0,a.Wm)(pe,{ref_key:"groupRef",ref:n,class:"menu",data:(0,s.SU)($),"node-key":(0,s.SU)(T).key,props:(0,s.SU)(T),"current-node-key":(0,s.SU)($).length?(0,s.SU)($)[0][(0,s.SU)(T).key]:"","highlight-current":"",onNodeClick:(0,s.SU)(X)},{default:(0,a.w5)((({node:e})=>[(0,a._)("span",m,[(0,a.Wm)(c,{class:"icon"},{default:(0,a.w5)((()=>[(0,a.Wm)(u)])),_:1}),(0,a.Uk)((0,t.zw)(e.label),1)])])),_:1},8,["data","node-key","props","current-node-key","onNodeClick"])]),e.multiple?((0,a.wg)(),(0,a.iD)("div",g,[_,(0,a._)("b",null,(0,t.zw)((0,s.SU)(M).length),1),S,(0,a._)("b",null,(0,t.zw)(e.max),1),v])):(0,a.kq)("",!0)])),[[be,(0,s.SU)(B)]]),(0,a.wy)(((0,a.wg)(),(0,a.iD)("div",U,[(0,a._)("div",y,[e.hideUpload?(0,a.kq)("",!0):((0,a.wg)(),(0,a.iD)("div",k,[(0,a.Wm)(me,{class:"sc-file-select__upload",action:"",multiple:"","show-file-list":!1,accept:(0,s.SU)(Q),"on-change":(0,s.SU)(oe),"before-upload":(0,s.SU)(ue),"on-progress":(0,s.SU)(ce),"on-success":(0,s.SU)(re),"on-error":(0,s.SU)(de),"http-request":(0,s.SU)(ne)},{default:(0,a.w5)((()=>[(0,a.Wm)(fe,{type:"primary",icon:"el-icon-upload"},{default:(0,a.w5)((()=>[w])),_:1})])),_:1},8,["accept","on-change","before-upload","on-progress","on-success","on-error","http-request"]),(0,a._)("span",b,[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(ge)])),_:1}),(0,a.Uk)("大小不超过"+(0,t.zw)(e.maxSize)+"MB",1)])])),(0,a._)("div",h,[(0,a.Wm)(_e,{modelValue:(0,s.SU)(L),"onUpdate:modelValue":i[0]||(i[0]=e=>(0,s.dq)(L)?L.value=e:null),"prefix-icon":"el-icon-search",placeholder:"文件名搜索",clearable:"",onKeyup:(0,o.D2)((0,s.SU)(le),["enter"]),onClear:(0,s.SU)(le)},null,8,["modelValue","onKeyup","onClear"])])]),(0,a._)("div",x,[(0,a.Wm)(ke,{ref_key:"scrollbarRef",ref:r},{default:(0,a.w5)((()=>[(0,s.SU)(Y).length||(0,s.SU)(J).length?(0,a.kq)("",!0):((0,a.wg)(),(0,a.j4)(Se,{key:0,description:"无数据","image-size":80})),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)((0,s.SU)(Y),((e,l)=>((0,a.wg)(),(0,a.iD)("div",{key:l,class:"sc-file-select__item"},[(0,a._)("div",C,[(0,a._)("div",z,[(0,a.Wm)(ve,{type:"circle",percentage:e.progress,width:70},null,8,["percentage"])]),(0,a.Wm)(Ue,{src:e.tempImg,fit:"contain"},null,8,["src"])]),(0,a._)("p",null,(0,t.zw)(e.name),1)])))),128)),((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)((0,s.SU)(J),(l=>((0,a.wg)(),(0,a.iD)("div",{key:l[(0,s.SU)(Z).key],class:(0,t.C_)(["sc-file-select__item",{active:(0,s.SU)(M).includes(l[(0,s.SU)(Z).url])}]),onClick:e=>(0,s.SU)(ie)(l)},[(0,a._)("div",D,[e.multiple?((0,a.wg)(),(0,a.iD)("div",H,[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(ye)])),_:1})])):((0,a.wg)(),(0,a.iD)("div",W,[(0,a.Wm)(c,null,{default:(0,a.w5)((()=>[(0,a.Wm)(ye)])),_:1})])),N,(0,s.SU)(se)(l[(0,s.SU)(Z).url])?((0,a.wg)(),(0,a.j4)(Ue,{key:2,src:l[(0,s.SU)(Z).url],fit:"contain",lazy:""},null,8,["src"])):((0,a.wg)(),(0,a.iD)("div",q,[(0,s.SU)(G)[(0,s.SU)(te)(l[(0,s.SU)(Z).url])]?((0,a.wg)(),(0,a.iD)("i",{key:0,class:(0,t.C_)((0,s.SU)(G)[(0,s.SU)(te)(l[(0,s.SU)(Z).url])].icon),style:(0,t.j5)({color:(0,s.SU)(G)[(0,s.SU)(te)(l[(0,s.SU)(Z).url])].color})},null,6)):((0,a.wg)(),(0,a.iD)("i",I))]))]),(0,a._)("p",{title:l[(0,s.SU)(Z).fileName]},(0,t.zw)(l[(0,s.SU)(Z).fileName]),9,O)],10,P)))),128))])),_:1},512)]),(0,a._)("div",j,[(0,a.Wm)(we,{small:"",background:"",layout:"prev, pager, next",total:(0,s.SU)(F),"page-size":(0,s.SU)(K),currentPage:(0,s.SU)(E),"onUpdate:currentPage":i[1]||(i[1]=e=>(0,s.dq)(E)?E.value=e:null),onCurrentChange:(0,s.SU)(ee)},null,8,["total","page-size","currentPage","onCurrentChange"])]),(0,a._)("div",R,[(0,a.WI)(l.$slots,"do"),(0,a.Wm)(fe,{type:"primary",disabled:(0,s.SU)(M).length<=0,onClick:(0,s.SU)(ae)},{default:(0,a.w5)((()=>[A])),_:1},8,["disabled","onClick"])])])),[[be,(0,s.SU)(V)]])])}}},V=(0,i(89).Z)(L,[["__scopeId","data-v-742ef626"]])}}]);